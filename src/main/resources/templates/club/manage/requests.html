<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head('페이지 제목', ~{::link}, ~{::script})}">
    <link rel="stylesheet" th:href="@{/css/manage.css}">
    <script src="#" th:if="${false}"></script>
</head>
<body>
<div class="grid-container">
<header th:replace="~{fragments/header :: header}"></header>


<div class="manage-main-container">
    <aside th:replace="~{fragments/manageSidebar :: sidebar('requests')}"></aside>

    <main class="manage-content-area">
        <h1>가입 신청 현황</h1>

        <table class="manage-table">
            <thead>
            <tr>
                <th>신청자 ID</th>
                <th>신청자 이름</th>
                <th>가입 답변</th>
                <th>신청 일시</th>
                <th>관리</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="request : ${joinRequests}">
                <td th:text="${request.memberId}">bgh_guest</td>
                <td th:text="${request.memberName}">가입신청자</td>
                <td>
                    <button type="button"
                            th:onclick="openManageModal([[${request.memberId}]], [[${request.memberName}]], [[${request.answerText}]])">
                        답변 보기
                    </button>
                </td>
                <td th:text="${#temporals.format(request.appliedAt, 'yyyy-MM-dd')}">2026-01-22</td>
                <td>
                    <form th:action="@{|/club/${clubId}/manage/approve|}" method="post" style="display:inline;">
                        <input type="hidden" name="memberId" th:value="${request.memberId}">
                        <button type="submit">승인</button>
                    </form>
                    <form th:action="@{|/club/${clubId}/manage/reject|}" method="post" style="display:inline;">
                        <input type="hidden" name="memberId" th:value="${request.memberId}">
                        <button type="submit">거절</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>

        <div th:if="${!paging.isEmpty()}" class="pagination-container" style="text-align: center; margin-top: 30px; margin-bottom: 30px;">
            <ul class="pagination" style="display: inline-flex; list-style: none; padding: 0; align-items: center;">
                <li th:classappend="${!paging.hasPrevious()} ? 'disabled'" style="margin: 0 10px;">
                    <a th:href="@{|/club/${clubId}/manage/requests?page=${paging.number - 1}|}"
                       th:style="${!paging.hasPrevious()} ? 'pointer-events: none; color: #ccc;' : 'text-decoration: none; color: #333;'">이전</a>
                </li>

                <li th:each="page: ${#numbers.sequence(0, paging.totalPages - 1)}" style="margin: 0 5px;">
                    <a th:text="${page + 1}"
                       th:href="@{|/club/${clubId}/manage/requests?page=${page}|}"
                       th:style="${page == paging.number} ? 'font-weight: bold; color: white; background: #007bff; padding: 5px 10px; border-radius: 4px;' : 'color: #666; padding: 5px 10px; border: 1px solid #ddd; border-radius: 4px; text-decoration: none;'"></a>
                </li>

                <li th:classappend="${!paging.hasNext()} ? 'disabled'" style="margin: 0 10px;">
                    <a th:href="@{|/club/${clubId}/manage/requests?page=${paging.number + 1}|}"
                       th:style="${!paging.hasNext()} ? 'pointer-events: none; color: #ccc;' : 'text-decoration: none; color: #333;'">다음</a>
                </li>
            </ul>
        </div>

        <div id="manageModal" class="modal" style="display:none; position:fixed; z-index:100; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.5);">
            <div class="modal-content" style="background:#fff; margin:15% auto; padding:20px; width:400px; border-radius:8px;">
                <h2 id="modalTitle">신청자 정보</h2>
                <hr>
                <p><strong>답변 내용:</strong></p>
                <div id="modalAnswer" style="background:#f9f9f9; padding:15px; border:1px solid #ddd; min-height:100px; white-space: pre-wrap;"></div>
                <div style="text-align:right; margin-top:15px;">
                    <button type="button" onclick="closeManageModal()">닫기</button>
                </div>
            </div>
        </div>
    </main>

<footer th:replace="~{fragments/footer :: footer}"></footer>
</div>
</div>
<script th:inline="javascript">
    function openManageModal(memberId, memberName, answerText) {
        // 1. 모달 요소 가져오기
        const modal = document.getElementById('manageModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalAnswer = document.getElementById('modalAnswer');

        // 2. 데이터 채우기
        modalTitle.innerText = memberName + "(" + memberId + ") 님의 가입 신청 답변";
        modalAnswer.innerText = answerText ? answerText : "제출된 답변이 없습니다.";

        // 3. 모달 보이기
        modal.style.display = 'block';
    }

    function closeManageModal() {
        document.getElementById('manageModal').style.display = 'none';
    }

    // 모달 외부 클릭 시 닫기
    window.onclick = function(event) {
        const modal = document.getElementById('manageModal');
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    }
</script>
</body>
</html>