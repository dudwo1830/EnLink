<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>게시글 상세보기</title>
    <style>
      /* a 태그의 기본 밑줄을 없앱니다 */
      a {
        text-decoration: none;
      }
    </style>
  </head>
  <body>
    <h1>게시글 상세 내용</h1>
    <hr />
    <div>
      <p><strong>제목:</strong> <span id="title">로딩 중...</span></p>
      <p><strong>작성자:</strong> <span id="memberId"></span></p>
      <p><strong>작성일:</strong> <span id="createdAt"></span></p>
      <div style="border: 1px solid #ccc; padding: 20px; min-height: 200px">
        <p id="content"></p>
      </div>
    </div>
    <br />
    <a th:href="@{/post/list}">
      <button type="button">목록으로</button>
    </a>

    <a th:href="@{/post/edit/{id}(id=${postId})}">
      <button type="button">게시글 수정</button>
    </a>

    <button
      type="button"
      onclick="deletePost()"
      style="background-color: red; color: white"
    >
      삭제하기
    </button>

    <script th:inline="javascript">
      // 타임리프를 통해 컨트롤러에서 넘겨받은 postId를 자바스크립트 변수로 사용
      /* 주석을 활용한 타임리프 인라인 문법 */
      const postId = /*[[${postId}]]*/ 0;

      document.addEventListener('DOMContentLoaded', function () {
        fetchDetail();
      });

      function fetchDetail() {
        // 이전에 만든 API 컨트롤러의 @GetMapping("/{postId}")를 호출합니다.
        fetch(`/api/posts/${postId}`)
          .then((response) => response.json())
          .then((post) => {
            if (post.imageUrl) {
              // max-width를 100%로 주면 부모 요소보다 커지지 않고,
              // 고정 크기(예: 500px)를 주면 적당한 크기로 고정됩니다.
              const imgTag = `
        <div style="margin: 20px 0; text-align: center;">
            <img src="/images/${post.imageUrl}" 
                 style="max-width: 500px; width: 100%; height: auto; border-radius: 8px; shadow: 0 4px 8px rgba(0,0,0,0.1);">
        </div>`;
              document
                .getElementById('content')
                .insertAdjacentHTML('beforebegin', imgTag);
            }
            document.getElementById('title').innerText = post.title;
            document.getElementById('memberId').innerText = post.memberId;
            document.getElementById('createdAt').innerText =
              post.createdAt.replace('T', ' ');
            document.getElementById('content').innerText = post.content;
          })
          .catch((error) => {
            console.error('Error:', error);
            alert('데이터를 가져오는 데 실패했습니다.');
          });
      }

      function deletePost() {
        if (!confirm('정말로 이 글을 삭제하시겠습니까?')) return;

        fetch(`/api/posts/${postId}`, {
          method: 'DELETE', // HTTP 메서드를 DELETE로 설정
        })
          .then((response) => {
            if (response.ok) {
              alert('삭제되었습니다.');
              location.href = '/post/list'; // 삭제 후 목록으로 이동
            } else {
              alert('삭제 실패!');
            }
          })
          .catch((error) => console.error('Error:', error));
      }
    </script>
  </body>
</html>
