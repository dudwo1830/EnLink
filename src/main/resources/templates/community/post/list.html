<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>게시글 목록</title>
    <style>
      table {
        width: 100%;
        border-collapse: collapse;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }
      th {
        background-color: #f2f2f2;
      }
    </style>
  </head>
  <body>
    <h1>모임 게시글 목록</h1>

    <div style="margin-bottom: 10px; text-align: right;">
        <button type="button" onclick="location.href='/post/write'"
                style="padding: 10px 20px; cursor: pointer; background-color: #4CAF50; color: white; border: none; border-radius: 4px;">
            게시글 작성하기
        </button>
    </div>

    <table>
      <thead>
        <tr>
          <th>번호</th>
          <th>제목</th>
          <th>작성자</th>
          <th>작성일</th>
        </tr>
      </thead>
      <tbody id="post-list"></tbody>
    </table>

    <script>
      // 페이지 로드 시 실행
      document.addEventListener('DOMContentLoaded', function () {
        fetchPosts(1); // 우선 clubId가 1인 데이터를 가져옴
      });

      function fetchPosts(clubId) {
        fetch(`/api/posts?clubId=${clubId}`)
          .then((response) => response.json())
          .then((posts) => {
            const listElement = document.getElementById('post-list');
            listElement.innerHTML = ''; // 기존 내용 비우기
            // 게시글 하나도 없을 때 안내 문구
            if (posts.length === 0) {
                listElement.innerHTML = '<tr><td colspan="4" style="text-align:center;">등록된 게시글이 없습니다. 첫 글을 남겨보세요!</td></tr>';
                return;
            }

        // list.html의 renderPosts 함수 내부 수정 예시
        posts.forEach((post) => {
            const row = `<tr>
                <td>${post.postId}</td>
                <td><a href="/post/detail/${post.postId}">${post.title}</a></td>
                <td>${post.memberId}</td>
                <td>${post.createdAt.split('T')[0]}</td>
            </tr>`;
            listElement.innerHTML += row;
            });
          })
          .catch((error) => console.error('Error:', error));
      }
    </script>
  </body>
</html>
