<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>글쓰기</title>
</head>
<body>
<h1>게시글 작성</h1>
<form id="writeForm" style="max-width: 800px;"> <label for="title">제목</label><br>
    <input type="text" id="title" style="width: 100%; padding: 10px; box-sizing: border-box;" placeholder="제목을 입력하세요" required><br><br>

    <label for="content">내용</label><br>
    <textarea id="content" rows="15" style="width: 100%; padding: 10px; box-sizing: border-box;" placeholder="내용을 입력하세요" required></textarea><br><br>

    <label>이미지 첨부</label><br>
    <input type="file" id="imageFile" accept="image/*" onchange="previewImage(this)"><br>
    <div id="imagePreviewContainer" style="margin-top: 10px; display: none;">
        <img id="preview" src="" style="max-width: 300px; border: 1px solid #ddd; border-radius: 5px;">
    </div>
    <br>

    <input type="hidden" id="clubId" value="1">
    <input type="hidden" id="memberId" value="user01">

    <button type="button" onclick="savePost()" style="padding: 10px 20px;">등록</button>
    <button type="button" onclick="history.back()" style="padding: 10px 20px;">취소</button>
</form>

<script>
    // 이미지 미리보기 로직
    function previewImage(input) {
        const container = document.getElementById('imagePreviewContainer');
        const preview = document.getElementById('preview');
        
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                container.style.display = 'block'; // 숨겨져 있던 컨테이너 표시
            }
            reader.readAsDataURL(input.files[0]);
        } else {
            preview.src = "";
            container.style.display = 'none';
        }
    }

    function savePost() {
    // JSON 대신 FormData 사용 (이미지 업로드를 위해)
    const formData = new FormData();
    formData.append('clubId', document.getElementById('clubId').value);
    formData.append('memberId', document.getElementById('memberId').value);
    formData.append('title', document.getElementById('title').value);
    formData.append('content', document.getElementById('content').value);
    // 나중에 input type="file" 추가 시 여기에 append 하면 됩니다.

    // 파일 업로드 처리
        const fileInput = document.getElementById('imageFile');
        if (fileInput.files[0]) {
            formData.append('image', fileInput.files[0]); // DTO의 필드명인 'image'와 맞춰야 함
        }

    fetch('/api/posts', {
        method: 'POST',
        // FormData를 보낼 때는 headers의 Content-Type을 설정하지 않아야 브라우저가 자동으로 multipart/form-data 설정해줌.
        body: formData 
    })
    .then(response => {
        if(response.ok) {
            alert('글이 성공적으로 등록되었습니다!');
            location.href = '/post/list';
        } else {
            alert('등록 실패!');
        }
    });
}
</script>
</body>
</html>