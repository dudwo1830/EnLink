<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head('EnLink - 내 모임 활동', ~{::link}, ~{::script})}">
    <link rel="stylesheet" th:href="@{/css/clubList.css}">
    <script th:src="@{/js/clubMember.js}"></script>
</head>
<body>
<style>
    .club-section { margin-bottom: 50px; }
    .club-section h2 { border-left: 5px solid #007bff; padding-left: 15px; margin-bottom: 20px; }

    .club-img-wrapper {
        width: 150px !important;
        height: 100px !important;
        overflow: hidden;
        border-radius: 8px;
    }
    .club-img-wrapper img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .btn-cancel { background-color: #ff4d4d; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
    .btn-manage { background-color: #28a745; color: white; padding: 5px 10px; border-radius: 4px; text-decoration: none; font-size: 0.9em; }
</style>

<div class="grid-container">
    <header th:replace="~{fragments/header :: header}" class="header"></header>

    <main class="main">
        <div class="list-content-container">
            <h1 th:text="${title}">제목</h1>
            <p>테스트 계정(bgh_leader) 님의 활동 정보입니다.</p>

            <div class="tab-menu">
                <a th:href="@{/mypage/clubs(type='owned')}" th:classappend="${currentType == 'owned'} ? 'active'">내가 만든 모임</a>
                <a th:href="@{/mypage/clubs(type='active')}" th:classappend="${currentType == 'active'} ? 'active'">참여 중인 모임</a>
                <a th:href="@{/mypage/clubs(type='pending')}" th:classappend="${currentType == 'pending'} ? 'active'">신청 현황</a>
            </div>

            <div th:if="${#lists.isEmpty(clubs)}" class="empty-msg">내역이 없습니다.</div>

            <div class="club-list">
                <div th:each="club : ${clubs}" class="club-item-card">
                    <a th:href="@{/club/{id}(id=${club.clubId})}">
                        <div class="club-img-wrapper">
                            <img th:src="${#strings.isEmpty(club.imageUrl) ? '/images/default_club.jpg' : club.imageUrl}" alt="모임 이미지">
                        </div>
                    </a>
                    <div class="club-info">
                        <h3 th:text="${club.name}">모임 이름</h3>

                        <div class="club-meta">
                            <th:block th:if="${currentType == 'owned'}">
                                <span>멤버 <span th:text="${club.currentMemberCount}">0</span> / <span th:text="${club.maxMember}">10</span></span>
                                <a th:href="@{/club/{id}/manage/requests(id=${club.clubId})}" class="btn-manage">관리 페이지</a>
                            </th:block>

                            <th:block th:if="${currentType == 'active'}">
                                <p class="club-meta">현재 멤버로서 활동 중입니다.</p>
                            </th:block>

                            <th:block th:if="${currentType == 'pending'}">
                            <form th:action="@{|/api/club/${club.clubId}/member/cancel|}" method="post" style="display:inline;">
                                <button type="submit" class="btn-cancel"
                                        onclick="return confirm('정말로 가입 신청을 취소하시겠습니까?')">
                                    신청 취소
                                </button>
                            </form>
                            </th:block>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <footer th:replace="~{fragments/footer :: footer}" class="footer"></footer>
</div>

</body>
</html>